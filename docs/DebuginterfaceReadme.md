# THUAI8 调试界面说明文档

## 1. 简介

本调试界面是基于 Avalonia UI 框架为 THUAI8 游戏开发的客户端工具。它旨在帮助参赛队伍和开发者观察游戏实时状态、调试选手代码逻辑以及回放比赛录像。

主要功能包括：

*   **实时连接模式:** 连接到正在运行的 THUAI8 游戏服务器，实时接收并显示游戏状态。
*   **回放模式:** 加载并播放预先录制的 `.pb` 格式比赛录像文件，支持调整播放速度。
*   **可视化界面:** 提供直观的图形用户界面，展示地图、角色、建筑、资源等信息。
*   **详细信息展示:** 显示队伍得分、经济、角色血量、状态、效果等详细数据。
*   **日志记录:** 将运行过程中的信息、警告和错误记录到日志文件中，方便问题排查。

## 2. 界面布局

主窗口界面主要分为左右两个区域：

[此处可插入主界面截图]

### 2.1. 左侧面板 (信息区)

此区域从上到下主要包含：

1.  **取经队伍信息区:**
    *   **标题:** "取经队伍" (背景色：淡黄色)。
    *   **经济:** 显示取经队伍当前的经济值。
    *   **角色列表:** 以卡片形式展示取经队伍的所有角色（包括未召唤或消失的占位符/实际角色）。
        *   **角色卡片:**
            *   **名称:** 角色类型名称 (如 "唐僧", "孙悟空")。
            *   **HP 血量条:** 显示当前 HP / 最大 HP。血条颜色根据队伍区分（默认取经队为绿色）。
            *   **状态:** 显示角色当前的主动状态
            *   **效果/状态:** 列出角色当前承受的被动状态或 Buff (如 "致盲", "加速", "护盾剩余")。
            *   **装备:** (当前版本可能为空) 显示角色拥有的装备。
    *   **建筑信息:** 文本显示取经队伍拥有的建筑及其状态摘要 (如 "兵营(600/600), 农场(400/400)")。

2.  **妖怪队伍信息区:**
    *   **标题:** "妖怪队伍" (背景色：淡蓝色)。
    *   **经济:** 显示妖怪队伍当前的经济值。
    *   **角色列表:** 同取经队伍区，展示妖怪队伍的角色信息。血条颜色默认为红色。
    *   **建筑信息:** 文本显示妖怪队伍拥有的建筑及其状态摘要。

3.  **连接状态区:**
    *   位于左下角，显示当前与服务器的连接状态（如 "正在初始化...", "正在连接服务器...", "已连接", "连接已断开", "回放模式", "回放结束" 等）。

### 2.2. 右侧面板 (地图与状态区)

此区域主要包含：

1.  **顶部状态栏:**
    *   **游戏时间:** 显示当前游戏进行的分钟和秒数 (mm:ss)。
    *   **得分:** 分别显示取经队伍和妖怪队伍的当前得分。

2.  **地图图例 (Expander):**
    *   位于右上角的可展开/折叠区域。
    *   点击 "地图图例" 标题可展开。
    *   显示地图上不同颜色方块代表的地形、建筑、资源等含义。

3.  **地图视图 (`Map`):**
    *   占据右侧大部分区域。
    *   **背景网格 (`MapGrid`):** 显示 50x50 的游戏地图格子。每个格子的背景色根据其地形类型（空地、障碍物、草丛、建筑点位、资源点等）或上面的具体物体（建筑、陷阱）进行着色。格子上的文本（如有）会显示 HP 或资源量等。
    *   **角色 (`CharacterCanvas`):** 在地图网格之上，使用不同颜色（红/蓝）和首字母标识的角色图标（圆形）来表示各个角色的实时位置。

## 3. 使用方法

### 3.1. 配置 (`config.json`)

调试器的行为主要通过配置文件 `config.json` 控制。该文件通常位于：

`` (Windows)
或类似的用户文档目录下。

你需要根据运行模式修改以下关键配置项：

1. **`Commands` 对象:**
   *   `"IP"`: (仅实时连接模式需要) 设置游戏服务器的 IP 地址，通常是 `"127.0.0.1"` (本机)。
   *   `"Port"`: (仅实时连接模式需要) 设置游戏服务器的端口号，通常是 `"8888"`。
   *   `"PlayerID"`: 设置你的客户端 ID。
       *   **重要:** 根据当前服务器逻辑，**大于 2025** 的 ID 会被视为**旁观者 (Spectator)**。如果你想以旁观者身份连接，请设置一个大于 2025 的值 (如 2026)。如果你想模拟某个队伍的玩家（通常用于测试 AI），请使用服务器分配或约定的 Player ID (通常是 0, 1, ...)。
   *   `"TeamID"`: (模拟玩家时需要) 设置你想加入的队伍 ID。根据当前服务器逻辑：
       *   `0`: 取经队伍 (Buddhists)
       *   `1`: 妖怪队伍 (Monsters)
       *   旁观者连接时，此项会被忽略。
   *   `"CharacterType"`: (模拟玩家时需要) 设置你想扮演的角色类型。对应关系见

   1. NULL_CHARACTER_TYPE = 0;

   2. TangSeng = 1;// 取经团队阵营角色

   3. SunWukong = 2;

   4. ZhuBajie = 3;

   5. ShaWujing = 4;

   6. BaiLongma = 5;

   7. Monkid = 6;

   8. JiuLing = 7;// 妖怪团队阵营角色

   9. HongHaier = 8;

   10. NiuMowang = 9;

   11. TieShan = 10;

   12. ZhiZhujing = 11;

   13. Pawn = 12;

       **旁观者连接时，此项会被忽略。**

   *   `"PlaybackFile"`:
       *   **回放模式:** 设置为你要播放的 `.pb` 录像文件的**完整路径**或**相对路径** (相对于调试器可执行文件)。例如: `"D:\\path\\to\\your\\playback.pb"` 或 `"./playbacks/game1.pb"`。
       *   **实时连接模式:** 将此项设置为空字符串 `""` 
   *   `"PlaybackSpeed"`: (仅回放模式需要) 设置回放速度，`1.0` 为正常速度，`2.0` 为两倍速，`0.5` 为半速。

### 3.2. 运行模式

#### 3.2.1. 实时连接模式

1.  **配置:** 确保 `config.json` 中的 `"PlaybackFile"` 设置为空 (`""`)。配置好正确的 `"IP"`, `"Port"`, `"PlayerID"` (如果是模拟玩家，还需配置 `"TeamID"` 和 `"CharacterType"`)。
2.  **启动服务器:** **先启动 THUAI8 游戏服务器** 并等待其开始监听（服务器日志会显示 "Server begins to listen!"）。
3.  **启动调试器:** 运行 `debug_interface.exe` (或通过 Visual Studio 启动)。（其实先启动调试器也可以，10秒内启动服务器就行）
4.  **观察:**
    *   左下角连接状态应显示 "正在连接...", 然后变为 "已连接"。
    *   地图和角色信息应在服务器发送数据后开始显示。
    *   如果连接失败或断开，状态栏会提示，并自动尝试重连。

#### 3.2.2. 回放模式

1.  **配置:** 在 `config.json` 中，将 `"PlaybackFile"` 设置为有效的 `.pb` 文件路径。设置 `"PlaybackSpeed"` 为你想要的速度。 `"IP"`, `"Port"`, `"PlayerID"` 等连接参数在此模式下会被忽略。
2.  **启动调试器:** 直接运行 `debug_interface.exe` (或通过 Visual Studio 启动)。**不需要启动游戏服务器**。
3.  **观察:**
    *   左下角连接状态应显示 "回放模式" 或类似信息。
    *   地图和角色信息应根据回放文件的内容和设定的速度进行播放。
    *   播放结束后，状态栏会显示 "回放结束"。

## 4. 日志文件

调试界面会将运行日志（包括连接信息、接收到的消息、错误等）记录到文件中，方便排查问题。

*   **日志位置:** `C:\Users\<你的用户名>\Documents\THUAI8\Logs\`
*   **文件名格式:** `Client.<TeamID>.<PlayerID>.log` (实时连接模式) 或 `debug_interface_<启动时间>.log` (如果 TeamID/PlayerID 未正确获取或在早期阶段)。

当遇到问题时，检查最新的日志文件通常能提供有用的线索。

## 5. 注意事项与已知问题

* **实时连接依赖服务器:** 实时连接模式必须先启动游戏服务器才能工作。

* **资源/陷阱显示:** 地图上经济资源、加成资源、陷阱的详细显示（如血量、资源量、特定颜色）依赖于服务器是否发送了对应类型的消息 (`MessageOfEconomyResource`, `MessageOfAdditionResource`, `MessageOfTrap`) 以及客户端 `UpdateMapElements` 方法是否正确处理。如果这些元素不显示，请先检查日志确认是否收到了相关消息。

  

